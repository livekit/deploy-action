# Copyright 2025 LiveKit, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: LiveKit Cloud Agents
description: Create, deploy, and manage LiveKit Cloud Agents
branding:
  icon: cloud
  color: purple
inputs:
  OPERATION:
    description: Operation to perform (create, deploy, status)
    required: true
    default: status
  WORKING_DIRECTORY:
    description: Which directory to run in
    required: false
    default: "."
  SLACK_TOKEN:
    description: Slack token for sending notifications
    required: false
  SLACK_CHANNEL:
    description: Slack channel to send notifications to (e.g., #general)
    required: false
  TIMEOUT:
    description: Timeout for the operation
    required: false
    default: "5m"
  REGION:
    description: Region to deploy to. If not specified, the nearest LiveKit Cloudregion will be used.
    required: false
    default: ""

runs:
  using: composite
  steps:
    - name: Run LiveKit Cloud Agent Operation
      shell: bash
      run: |
        docker run --rm \
          -v /tmp/shared:/tmp/shared \
          -e INPUT_OPERATION="${{ inputs.OPERATION }}" \
          -e INPUT_WORKING_DIRECTORY="${{ inputs.WORKING_DIRECTORY }}" \
          -e INPUT_TIMEOUT="${{ inputs.TIMEOUT }}" \
          -e INPUT_REGION="${{ inputs.REGION }}" \
          -e SLACK_TOKEN="${{ inputs.SLACK_TOKEN }}" \
          -e SLACK_CHANNEL="${{ inputs.SLACK_CHANNEL }}" \
          -e LIVEKIT_URL="${{ env.LIVEKIT_URL }}" \
          -e LIVEKIT_API_KEY="${{ env.LIVEKIT_API_KEY }}" \
          -e LIVEKIT_API_SECRET="${{ env.LIVEKIT_API_SECRET }}" \
          -e SECRET_LIST="${{ env.SECRET_LIST }}" \
          -e GITHUB_RUN_ID="${{ github.run_id }}" \
          -v "${{ github.workspace }}:/workspace" \
          -w "/workspace" \
          docker.io/livekit/cloud-agents-github-plugin:v2.12.1
